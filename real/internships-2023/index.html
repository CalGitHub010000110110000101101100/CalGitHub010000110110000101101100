<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Internships summer 2023</title>
    <meta name="description" content="It's a very simple sankey diagram." />

    <link rel="stylesheet" type="text/css" href="/sheep3.css" />
    <script src="/sheep3.js" charset="utf-8"></script>

    <style>
      :root {
        color-scheme: dark;
      }

      body {
        background-color: #191b20;
        color: rgba(255, 255, 255, 0.9);
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          'Helvetica Neue', Arial, sans-serif, 'Apple Color Emoji',
          'Segoe UI Emoji', 'Segoe UI Symbol';
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      main {
        display: flex;
        flex-direction: column;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        gap: 20px;
      }

      .home {
        display: flex;
        align-self: flex-start;
        align-items: center;
        gap: 8px;
        padding: 8px;
        border-radius: 10px;
      }
      .home:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      .home:active {
        background-color: rgba(255, 255, 255, 0.2);
      }
      .icon {
        display: inline-block;
        width: 24px;
        height: 24px;
        background-position: center;
        background-repeat: no-repeat;
      }
      .icon-home {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgba(255, 255, 255, 0.9)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round' class='feather feather-home'%3E%3Cpath d='M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z'%3E%3C/path%3E%3Cpolyline points='9 22 9 12 15 12 15 22'%3E%3C/polyline%3E%3C/svg%3E");
      }

      #graph {
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        height: 60vh;
        position: relative;
      }
      #graph svg {
        position: absolute;
        top: 0;
        left: 0;
      }
    </style>
  </head>
  <body>
    <main>
      <a href="/" class="home">
        <span class="icon icon-home"></span>
        Home
      </a>
      <div id="graph"></div>
    </main>
    <script type="module">
      import * as d3 from 'https://cdn.jsdelivr.net/npm/d3@7.8.5/+esm'
      import {
        sankey as sankeyJustify,
        sankeyLinkHorizontal
      } from 'https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/+esm'

      const svg = d3.create('svg')
      const sankey = sankeyJustify()
        .nodeId(d => d.name)
        .nodeWidth(15)
        .nodePadding(10)

      // Nodes
      const rect = svg.append('g').attr('stroke', '#000').selectAll()

      const link = svg
        .append('g')
        .attr('fill', 'none')
        .attr('stroke-opacity', 0.5)
        .selectAll()

      const labels = svg.append('g').selectAll()

      function resize (width, height) {
        svg.attr('width', width).attr('height', height)
        sankey.extent([
          [1, 5],
          [width - 1, height - 5]
        ])

        const { nodes, links } = sankey({
          nodes: [{ name: 'test' }, { name: 'test 2' }, { name: 'test 3' }],
          links: [
            { source: 'test', target: 'test 2', value: 1 },
            { source: 'test', target: 'test 3', value: 2 }
          ]
        })
        rect
          .data(nodes)
          .join('rect')
          .attr('fill', d => 'red')
          .attr('x', d => d.x0)
          .attr('y', d => d.y0)
          .attr('height', d => d.y1 - d.y0)
          .attr('width', d => d.x1 - d.x0)
          .append('title')
          .text(d => `${d.name}\n${d.value} TWh`)

        const ourLink = link
          .data(links)
          .join('g')
          .style('mix-blend-mode', 'plus-lighter')

        const gradient = ourLink
          .append('linearGradient')
          .attr('id', d => (d.uid = `${Math.random()}`))
          .attr('gradientUnits', 'userSpaceOnUse')
          .attr('x1', d => d.source.x1)
          .attr('x2', d => d.target.x0)
        gradient
          .append('stop')
          .attr('offset', '0%')
          .attr('stop-color', d => 'red')
        gradient
          .append('stop')
          .attr('offset', '100%')
          .attr('stop-color', d => 'blue')

        ourLink
          .append('path')
          .attr('d', sankeyLinkHorizontal())
          .attr('stroke', d => `url(#${d.uid})`)
          .attr('stroke-width', d => Math.max(1, d.width))
          .append('title')
          .text(d => `${d.source.name} â†’ ${d.target.name}\n${d.value} TWh`)

        labels
          .data(nodes)
          .join('text')
          .attr('x', d => (d.x0 < width / 2 ? d.x1 + 6 : d.x0 - 6))
          .attr('y', d => (d.y1 + d.y0) / 2)
          .attr('dy', '0.35em')
          .attr('text-anchor', d => (d.x0 < width / 2 ? 'start' : 'end'))
          .text(d => d.name)
      }

      // Append the SVG element.
      const graph = document.getElementById('graph')
      graph.append(svg.node())
      new ResizeObserver(([{ contentBoxSize }]) => {
        const [{ blockSize, inlineSize }] = contentBoxSize
        resize(inlineSize, blockSize)
      }).observe(graph)
    </script>
  </body>
</html>
